<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡Hola, Mundo! → Heathens </title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            background: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            opacity: 0;
            animation: fadeInBody 1.5s ease-in forwards;
        }

        @keyframes fadeInBody {
            to { opacity: 1; }
        }

        /* --- ESCENA 1: TEXTO --- */
        #scene1 {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            opacity: 1;
            transition: opacity 2s ease-out;
        }

        .letter {
            display: inline-block;
            font-size: 4.5rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                0 0 10px #ff0,
                0 0 20px #ff0,
                0 0 40px #ff0,
                0 0 80px #ff0;
            opacity: 0;
            transform: translateY(-300px);
            animation: fall 1.5s ease-out forwards, glow 2s infinite alternate;
        }

        @keyframes fall {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #ff0, 0 0 20px #ff0; }
            to { text-shadow: 0 0 30px #ff0, 0 0 60px #ff0, 0 0 90px #ff0; }
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        /* --- ESCENA 2: VIDEO (API) --- */
        #scene2 {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 2s ease-in;
            z-index: 1;
        }

        .video-container {
            width: 90%;
            max-width: 900px;
            aspect-ratio: 16 / 9;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        #player {
            width: 100%;
            height: 100%;
        }

        .fallback {
            display: none;
            text-align: center;
            color: #ffd700;
            font-size: 1.2rem;
            padding: 20px;
        }

        .fallback a {
            color: #ff0;
            text-decoration: none;
            font-weight: bold;
        }

        .credits {
            position: absolute;
            bottom: 20px;
            color: rgba(255, 215, 0, 0.8);
            font-size: 0.9rem;
            z-index: 20;
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>

    <!-- ESCENA 1: Animación -->
    <div id="scene1">
        <div id="text"></div>
        <canvas id="confetti"></canvas>
    </div>

    <!-- ESCENA 2: Video con API -->
    <div id="scene2">
        <div class="video-container">
            <div id="player"></div>
            <div class="fallback">
                <p>Video no disponible. <a href="https://www.youtube.com/watch?v=UprcpdwuwCg" target="_blank">Abrir en YouTube</a></p>
            </div>
        </div>
    </div>

    <div class="credits">
        Animación: Tú | Música: twenty one pilots - Heathens (API Fix)
    </div>

    <!-- CARGAR API de YouTube -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        const scene1 = document.getElementById('scene1');
        const scene2 = document.getElementById('scene2');
        const textContainer = document.getElementById('text');
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        const playerDiv = document.getElementById('player');
        const fallback = document.querySelector('.fallback');

        let player;

        // --- Canvas ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // --- Texto ---
        const message = "¡Hola, Mundo!";
        const letters = message.split('');
        let animationDone = false;

        letters.forEach((char, i) => {
            setTimeout(() => {
                const span = document.createElement('span');
                span.className = 'letter';
                span.textContent = char === ' ' ? '\u00A0' : char;
                span.style.animationDelay = `${i * 0.15}s`;
                textContainer.appendChild(span);

                if (i === letters.length - 1) {
                    setTimeout(triggerConfetti, 800);
                    setTimeout(startTransition, 3000);
                }
            }, i * 150);
        });

        // --- Confeti ---
        const confetti = [];
        const colors = ['#ff0', '#ffd700', '#ff4500', '#ff69b4', '#00ced1', '#ff1493'];

        function triggerConfetti() {
            for (let i = 0; i < 300; i++) {
                confetti.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    r: Math.random() * 6 + 2,
                    d: Math.random() * 300 + 100,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    tilt: Math.random() * 10 - 5,
                    tiltAngleIncremental: Math.random() * 0.08 + 0.02,
                    tiltAngle: 0
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;

            confetti.forEach((p) => {
                p.tiltAngle += p.tiltAngleIncremental;
                p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
                p.x += Math.sin(p.d) * 0.5;
                p.tilt = Math.sin(p.tiltAngle) * 15;

                if (p.y <= canvas.height) {
                    active = true;
                    drawPiece(p);
                }
            });

            if (active) requestAnimationFrame(animateConfetti);
        }

        function drawPiece(p) {
            ctx.beginPath();
            ctx.lineWidth = p.r / 2;
            ctx.strokeStyle = p.color;
            ctx.moveTo(p.x + p.tilt + p.r / 2, p.y);
            ctx.lineTo(p.x + p.tilt - p.r / 2, p.y + p.tilt + p.r / 2);
            ctx.stroke();
        }

        // --- TRANSICIÓN ---
        function startTransition() {
            scene1.style.opacity = '0';
            setTimeout(() => {
                scene2.style.opacity = '1';
                if (!animationDone) {
                    loadYouTubePlayer();
                    animationDone = true;
                }
            }, 2000);
        }

        // --- API de YouTube (SIN ERROR 153) ---
        function loadYouTubePlayer() {
            if (typeof YT === 'undefined' || !YT.Player) {
                setTimeout(loadYouTubePlayer, 500);
                return;
            }

            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: 'UprcpdwuwCg',
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 0,
                    'modestbranding': 1,
                    'playsinline': 1
                },
                events: {
                    'onReady': (e) => {
                        console.log("Video listo!");
                    },
                    'onError': (e) => {
                        console.error("Error YouTube:", e.data);
                        fallback.style.display = 'block';
                        playerDiv.style.display = 'none';
                    }
                }
            });
        }

        // Cargar API al inicio
        window.onYouTubeIframeAPIReady = loadYouTubePlayer;
    </script>
</body>
</html>